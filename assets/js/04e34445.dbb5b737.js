"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[73282],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>u});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),d=c(n),u=r,g=d["".concat(l,".").concat(u)]||d[u]||m[u]||i;return n?a.createElement(g,s(s({ref:t},p),{},{components:n})):a.createElement(g,s({ref:t},p))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=d;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,s[1]=o;for(var c=2;c<i;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},20257:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var a=n(87462),r=(n(67294),n(3905));const i={title:"Create E-mail Subscription Panel with Refine and Strapi",description:"We will make a web application that allows you to quickly create subscribers and send emails to your subscribers in a simple way. We\u2019ll use refine to develop the frontend easily and strapi for backend solutions.",slug:"e-mail-subscription-panel-with-refine",authors:"melih",tags:["refine","strapi","react","tutorial"],image:"https://refine.ams3.cdn.digitaloceanspaces.com/website/static/img/placeholder.png",hide_table_of_contents:!1},s=void 0,o={permalink:"/blog/e-mail-subscription-panel-with-refine",source:"@site/blog/2021-10-25-mail-subscription-with-refine.md",title:"Create E-mail Subscription Panel with Refine and Strapi",description:"We will make a web application that allows you to quickly create subscribers and send emails to your subscribers in a simple way. We\u2019ll use refine to develop the frontend easily and strapi for backend solutions.",date:"2021-10-25T00:00:00.000Z",formattedDate:"October 25, 2021",tags:[{label:"refine",permalink:"/blog/tags/refine"},{label:"strapi",permalink:"/blog/tags/strapi"},{label:"react",permalink:"/blog/tags/react"},{label:"tutorial",permalink:"/blog/tags/tutorial"}],readingTime:7.555,hasTruncateMarker:!0,authors:[{name:"Melih Ekinci",title:"Frontend Developer",url:"https://github.com/mlhekinci",imageURL:"https://github.com/mlhekinci.png",key:"melih"}],frontMatter:{title:"Create E-mail Subscription Panel with Refine and Strapi",description:"We will make a web application that allows you to quickly create subscribers and send emails to your subscribers in a simple way. We\u2019ll use refine to develop the frontend easily and strapi for backend solutions.",slug:"e-mail-subscription-panel-with-refine",authors:"melih",tags:["refine","strapi","react","tutorial"],image:"https://refine.ams3.cdn.digitaloceanspaces.com/website/static/img/placeholder.png",hide_table_of_contents:!1},prevItem:{title:"Create Your Easy Customizable Internal Issue Tracker With Refine and Supabase",permalink:"/blog/customizable-issue-tracker-with-refine-and-supabase"},nextItem:{title:"Migrating a React-Admin Application to Refine",permalink:"/blog/migrating-a-react-admin-application-to-refine"},relatedPosts:[{title:"React Hook Form Validation with Complete Examples",permalink:"/blog/react-hook-form-validation-examples",formattedDate:"September 27, 2022",authors:[{name:"David Omotayo",title:"Frontend developer",url:"https://github.com/david4473",imageURL:"https://github.com/david4473.png",key:"david_omotayo"}],readingTime:17.63,date:"2022-09-27T00:00:00.000Z"},{title:"How to use React Strict Mode in React 18",permalink:"/blog/react-strict-mode-in-react-18",formattedDate:"November 24, 2022",authors:[{name:"Deborah Emeni",title:"Software Engineer",url:"https://github.com/debemenitammy",imageURL:"https://github.com/debemenitammy.png",key:"deborah_emeni"}],readingTime:6.99,date:"2022-11-24T00:00:00.000Z"},{title:"Build a Progressive Web App (PWA) with Next.js",permalink:"/blog/next-js-pwa",formattedDate:"September 11, 2022",authors:[{name:"David Omotayo",title:"Frontend developer",url:"https://github.com/david4473",imageURL:"https://github.com/david4473.png",key:"david_omotayo"}],readingTime:18.495,date:"2022-09-11T00:00:00.000Z"}],authorPosts:[{title:"Refine vs React-Admin Which is Better for Your Project?",permalink:"/blog/refine-vs-react-admin",formattedDate:"November 26, 2021",authors:[{name:"Melih Ekinci",title:"Frontend Developer",url:"https://github.com/mlhekinci",imageURL:"https://github.com/mlhekinci.png",key:"melih"}],readingTime:14.5,date:"2021-11-26T00:00:00.000Z"},{title:"Create Your Easy Customizable Internal Issue Tracker With Refine and Supabase",permalink:"/blog/customizable-issue-tracker-with-refine-and-supabase",formattedDate:"November 12, 2021",authors:[{name:"Melih Ekinci",title:"Frontend Developer",url:"https://github.com/mlhekinci",imageURL:"https://github.com/mlhekinci.png",key:"melih"}],readingTime:18.205,date:"2021-11-12T00:00:00.000Z"},{title:"How to upload files from your HTML form using Base64 encoding",permalink:"/blog/how-to-base64-upload",formattedDate:"December 22, 2021",authors:[{name:"Melih Ekinci",title:"Frontend Developer",url:"https://github.com/mlhekinci",imageURL:"https://github.com/mlhekinci.png",key:"melih"}],readingTime:3.36,date:"2021-12-22T00:00:00.000Z"}]},l={authorsImageUrls:[void 0]},c=[{value:"Creating API with <code>Strapi</code>",id:"creating-api-with-strapi",level:2},{value:"Creating panel with <code>refine</code>",id:"creating-panel-with-refine",level:2},{value:"Subscriber List",id:"subscriber-list",level:2},{value:"Message List",id:"message-list",level:2},{value:"Create Subscriber",id:"create-subscriber",level:2},{value:"Create Message",id:"create-message",level:2},{value:"Strapi E-mail Plugin",id:"strapi-e-mail-plugin",level:2},{value:"Configure your provider",id:"configure-your-provider",level:3}],p={toc:c};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"We will make a web application that allows you to quickly create subscribers and send emails to your subscribers in a simple way. We\u2019ll use refine to develop the frontend easily and strapi for backend solutions."),(0,r.kt)("p",null,"Let's start by creating our strapi and refine projects."),(0,r.kt)("h2",{id:"creating-api-with-strapi"},"Creating API with ",(0,r.kt)("inlineCode",{parentName:"h2"},"Strapi")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npx create-strapi-app strapi-email-subscription-api --quickstart\n")),(0,r.kt)("p",null,"After the project is loaded, the admin panel will open automatically open in the browser. We need to create an admin user in order to log in to the strapi."),(0,r.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2021-10-25-mail-subscription-with-refine/strapi.png",alt:"strapi"}),(0,r.kt)("p",null,"With the information we will create here, we can now enter the strapi and start shaping our backend."),(0,r.kt)("p",null,"After logging into the Strapi interface, we have two collection models that we need to create for our e-mail subscription project."),(0,r.kt)("p",null,"We will create these collections from the Collection-Types Builder part of the strapi."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Subscribers"),(0,r.kt)("ul",{parentName:"blockquote"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"name")," text field"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"email")," Email"))),(0,r.kt)("div",{class:"img-container"},(0,r.kt)("div",{class:"window"},(0,r.kt)("div",{class:"control red"}),(0,r.kt)("div",{class:"control orange"}),(0,r.kt)("div",{class:"control green"})),(0,r.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2021-10-25-mail-subscription-with-refine/subscribers.png",alt:"subscribers"})),(0,r.kt)("br",null),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Messages"),(0,r.kt)("ul",{parentName:"blockquote"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"subject")," text field"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"text")," text field"))),(0,r.kt)("div",{class:"img-container"},(0,r.kt)("div",{class:"window"},(0,r.kt)("div",{class:"control red"}),(0,r.kt)("div",{class:"control orange"}),(0,r.kt)("div",{class:"control green"})),(0,r.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2021-10-25-mail-subscription-with-refine/messages.png",alt:"messages"})),(0,r.kt)("br",null),(0,r.kt)("p",null,"With these collections and features we have created, we can now create subscribers, delete them and make changes to them."),(0,r.kt)("h2",{id:"creating-panel-with-refine"},"Creating panel with ",(0,r.kt)("inlineCode",{parentName:"h2"},"refine")),(0,r.kt)("p",null,"Now let's refine the subscription panel. With ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/pankod/superplate"},"superplate"),", we can quickly create a refine project"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npx superplate-cli email-subscription-panel\n")),(0,r.kt)("p",null,"Select the following options to complete the CLI wizard:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"? Select your project type:\n> refine-react\n\n? What will be the name of your app:\n> email-subscription-panel\n\n? Package manager:\n> Npm\n\n? Do you want to use a UI Framework?:\n\u276f Ant Design\n\n? Do you want a customized theme?:\n> Default theme\n\n? Router Provider:\n\u276f React Router v6\n\n? Data Provider: \n> Strapi\n\n? Do you want a customized layout?:\n> Yes\n\n? i18n - Internationalization: \n> No\n")),(0,r.kt)("p",null,"After the upload is finished, let's go into our project and see how it looks."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd email-subscription-panel\nnpm run dev\n")),(0,r.kt)("p",null,"This is a example Refine project:"),(0,r.kt)("div",{class:"img-container"},(0,r.kt)("div",{class:"window"},(0,r.kt)("div",{class:"control red"}),(0,r.kt)("div",{class:"control orange"}),(0,r.kt)("div",{class:"control green"})),(0,r.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2021-10-25-mail-subscription-with-refine/refine_welcome.png",alt:"refine_welcome"})),(0,r.kt)("br",null),(0,r.kt)("p",null,"Let's list our messages and subscribers with refine. Here are the changes we need to make:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Change Strapi API URL from refine"),(0,r.kt)("li",{parentName:"ul"},"Adding resources according to the collection name we created in Strapi")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="App.tsx"',title:'"App.tsx"'},'import { Refine, Resource } from "@pankod/refine";\n\nimport "@pankod/refine/dist/styles.min.css";\nimport { DataProvider } from "@pankod/refine-strapi";\nimport strapiAuthProvider from "authProvider";\nimport { Header, Layout, OffLayoutArea } from "components";\n\n\nfunction App() {\n - const API_URL = "your-strapi-api-url";\n + const API_URL = "http://localhost:1337";\n\n  const { authProvider, axiosInstance } = strapiAuthProvider(API_URL);\n  const dataProvider = DataProvider(API_URL, axiosInstance);\n  return (\n    <Refine\n      dataProvider={dataProvider}\n      authProvider={authProvider}\n      Header={Header}\n      Layout={Layout}\n      OffLayoutArea={OffLayoutArea}\n      routerProvider={routerProvider}\n      resources={[{\n        name: "subscribers",\n      }, {\n        name: "messages",\n      }]} \n    />\n  );\n}\n\nexport default App;\n\n')),(0,r.kt)("div",{class:"img-container"},(0,r.kt)("div",{class:"window"},(0,r.kt)("div",{class:"control red"}),(0,r.kt)("div",{class:"control orange"}),(0,r.kt)("div",{class:"control green"})),(0,r.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2021-10-25-mail-subscription-with-refine/signin.png",alt:"signin"})),(0,r.kt)("br",null),(0,r.kt)("p",null,"After adding the resources, we need to define a user in the strapi in order to be able to login to the refine. "),(0,r.kt)("div",{class:"img-container"},(0,r.kt)("div",{class:"window"},(0,r.kt)("div",{class:"control red"}),(0,r.kt)("div",{class:"control orange"}),(0,r.kt)("div",{class:"control green"})),(0,r.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2021-10-25-mail-subscription-with-refine/auth.png",alt:"auth"})),(0,r.kt)("br",null),(0,r.kt)("p",null,"Let's login with this user we created"),(0,r.kt)("div",{class:"img-container"},(0,r.kt)("div",{class:"window"},(0,r.kt)("div",{class:"control red"}),(0,r.kt)("div",{class:"control orange"}),(0,r.kt)("div",{class:"control green"})),(0,r.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2021-10-25-mail-subscription-with-refine/login.gif",alt:"login"})),(0,r.kt)("p",null,"We can now list subscribers and messages and make changes to our list. Before doing this, let's create test users and messages on the strapi side. "),(0,r.kt)("div",{class:"img-container"},(0,r.kt)("div",{class:"window"},(0,r.kt)("div",{class:"control red"}),(0,r.kt)("div",{class:"control orange"}),(0,r.kt)("div",{class:"control green"})),(0,r.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2021-10-25-mail-subscription-with-refine/dummy_data.png",alt:"dummy_data"})),(0,r.kt)("br",null),(0,r.kt)("p",null,"Create SubscriberList.tsx and MessagesList.tsx file under the pages folder. Then, let's create our component as follows with the components and hooks that come with refine."),(0,r.kt)("h2",{id:"subscriber-list"},"Subscriber List"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="/src/pages/subscriber/SubscriberList.tsx"',title:'"/src/pages/subscriber/SubscriberList.tsx"'},'import React from "react";\nimport {\n  useTable,\n  List,\n  Table,\n  DateField,\n  DeleteButton,\n  IResourceComponentsProps,\n} from "@pankod/refine";\n\nimport { ISubscriber } from "interfaces";\n\nexport const SubscriberList: React.FC<IResourceComponentsProps> = () => {\n  const { tableProps } = useTable<ISubscriber>();\n  return (\n    <List>\n      <Table {...tableProps} rowKey="id">\n        <Table.Column dataIndex="id" title="Id" />\n        <Table.Column dataIndex="name" title="Name" />\n        <Table.Column dataIndex="email" title="E-mail" />\n        <Table.Column\n          dataIndex="created_at"\n          title="createdAt"\n          render={(value) => <DateField format="LLL" value={value} />}\n        />\n        <Table.Column<ISubscriber>\n          title="Unsubscribe"\n          dataIndex="actions"\n          render={(_, record): React.ReactNode => {\n            return (\n              <DeleteButton size="small" recordItemId={record.id} hideText />\n            );\n          }}\n        />\n      </Table>\n    </List>\n  );\n};\n\n')),(0,r.kt)("h2",{id:"message-list"},"Message List"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="/src/pages/mail/MessageList.tsx"',title:'"/src/pages/mail/MessageList.tsx"'},'import React from "react";\nimport {\n  useTable,\n  List,\n  Table,\n  DateField,\n  IResourceComponentsProps,\n} from "@pankod/refine";\n\nimport { IMail } from "interfaces";\n\nexport const MessageList: React.FC<IResourceComponentsProps> = () => {\n  const { tableProps } = useTable<IMail>();\n  return (\n    <List>\n      <Table {...tableProps} rowKey="id">\n        <Table.Column dataIndex="id" title="Id" />\n        <Table.Column dataIndex="subject" title="Subject" />\n        <Table.Column dataIndex="text" title="Body" />\n        <Table.Column \n          dataIndex="created_at"\n          title="createdAt"\n          render={(value) => <DateField format="LLL" value={value} />}\n        />\n      </Table>\n    </List>\n  );\n};\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="/src/interfaces/intex.d.ts"',title:'"/src/interfaces/intex.d.ts"'},"export interface ISubscriber {\n  id: any;\n  name: string;\n  email: string;\n  created_at: string;\n}\n\nexport interface IMail {\n  subject: string;\n  text: string;\n  to: string;\n  create_at: string;\n}\n")),(0,r.kt)("p",null,"In this component:"),(0,r.kt)("p",null,"We used refine's ",(0,r.kt)("a",{parentName:"p",href:"https://refine.dev/docs/examples/list/useSimpleList"},"list")," and ",(0,r.kt)("a",{parentName:"p",href:"https://refine.dev/docs/api-references/hooks/table/useTable/"},"table")," to show our subscribers and messages."),(0,r.kt)("p",null,"Now let's see how our subscriber panel looks like:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Subscriber:")),(0,r.kt)("div",{class:"img-container"},(0,r.kt)("div",{class:"window"},(0,r.kt)("div",{class:"control red"}),(0,r.kt)("div",{class:"control orange"}),(0,r.kt)("div",{class:"control green"})),(0,r.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2021-10-25-mail-subscription-with-refine/refine_subs.png",alt:"refine_subs"})),(0,r.kt)("br",null),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Messages:")),(0,r.kt)("div",{class:"img-container"},(0,r.kt)("div",{class:"window"},(0,r.kt)("div",{class:"control red"}),(0,r.kt)("div",{class:"control orange"}),(0,r.kt)("div",{class:"control green"})),(0,r.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2021-10-25-mail-subscription-with-refine/refine_messages.png",alt:"refine_messages"})),(0,r.kt)("br",null),(0,r.kt)("p",null,"As you can see, we were able to list our subscribers and e-mails very simply with refine. Now let's examine how we can create subscribers and messages from our interface."),(0,r.kt)("h2",{id:"create-subscriber"},"Create Subscriber"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="/src/pages/subscriber/create.tsx"',title:'"/src/pages/subscriber/create.tsx"'},'import {\n  Create,\n  Form,\n  Input,\n  useForm,\n  IResourceComponentsProps,\n} from "@pankod/refine";\n\nimport { ICreateSubscriber } from "interfaces";\n\nexport const CreateSubscriber: React.FC<IResourceComponentsProps> = () => {\n  const { formProps, saveButtonProps } = useForm<ICreateSubscriber>();\n\n  return (\n    <Create saveButtonProps={saveButtonProps}>\n      <Form {...formProps} layout="vertical">\n        <Form.Item label="Name" name="name">\n          <Input />\n        </Form.Item>\n        <Form.Item\n          label="E-mail"\n          name="email"\n          rules={[\n            {\n              required: true,\n            },\n          ]}\n        >\n          <Input />\n        </Form.Item>\n      </Form>\n    </Create>\n  );\n};\n')),(0,r.kt)("h2",{id:"create-message"},"Create Message"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="/src/pages/mail/create.tsx"',title:'"/src/pages/mail/create.tsx"'},'import React from "react";\nimport {\n  Create,\n  Form,\n  Input,\n  useForm,\n  IResourceComponentsProps,\n} from "@pankod/refine";\n\nimport MDEditor from "@uiw/react-md-editor";\nimport { IMail } from "interfaces";\n\nexport const MailCreate: React.FC<IResourceComponentsProps> = () => {\n  const { formProps, saveButtonProps } = useForm<IMail>();\n\n  return (\n    <Create saveButtonProps={saveButtonProps}>\n      {console.log("create")}\n      <Form {...formProps} layout="vertical">\n        <Form.Item\n          label="Subject"\n          name="subject"\n          rules={[\n            {\n              required: true,\n            },\n          ]}\n        >\n          <Input />\n        </Form.Item>\n        <Form.Item\n          label="Body"\n          name="text"\n          rules={[\n            {\n              required: true,\n            },\n          ]}\n        >\n          <MDEditor data-color-mode="light" />\n        </Form.Item>\n        <Form.Item\n          label="To"\n          name="to"\n          rules={[\n            {\n              required: true,\n            },\n          ]}\n        >\n          <Input />\n        </Form.Item>\n      </Form>\n    </Create>\n  );\n};\n')),(0,r.kt)("p",null,"Using refine's ",(0,r.kt)("a",{parentName:"p",href:"https://refine.dev/docs/api-reference/antd/hooks/form/useForm/"},"form")," and ",(0,r.kt)("a",{parentName:"p",href:"https://refine.dev/docs/ui-frameworks/antd/components/basic-views/create/"},"create")," components, we can now create subscribers and messages with refine."),(0,r.kt)("div",{class:"img-container"},(0,r.kt)("div",{class:"window"},(0,r.kt)("div",{class:"control red"}),(0,r.kt)("div",{class:"control orange"}),(0,r.kt)("div",{class:"control green"})),(0,r.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2021-10-25-mail-subscription-with-refine/create.gif",alt:"create"})),(0,r.kt)("br",null),(0,r.kt)("p",null,"We're done with our panel. We can now list, create and delete subscribers. Finally, the step of sending real mails using our panel and strapi is left. Let's see how we do this."),(0,r.kt)("h2",{id:"strapi-e-mail-plugin"},"Strapi E-mail Plugin"),(0,r.kt)("p",null,"In order to send mail via Strapi, we need to install the ",(0,r.kt)("a",{parentName:"p",href:"https://strapi.io/documentation/developer-docs/latest/development/plugins/email.html#programmatic-usage"},"strapi-email")," plugin in our api project that we created above."),(0,r.kt)("p",null,"Let's open our API project that we created and download the email plugin."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd strapi-email-subscription-api\nnpm install strapi-provider-email-sendgrid --save\n")),(0,r.kt)("p",null,"After installing your plugin you will need to add some settings in config/plugins.js. If this file doesn't exists, you'll need to create it. "),(0,r.kt)("h3",{id:"configure-your-provider"},"Configure your provider"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Path \u2014 ./config/plugins.js")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"module.exports = ({ env }) => ({\n    email: {\n      provider: 'sendgrid',\n      providerOptions: {\n        apiKey: env('SENDGRID_API_KEY'),\n      },\n      settings: {\n        defaultFrom: 'your-email-adress',\n        defaultReplyTo: 'your-email-adress',\n        testAddress: 'your-email-adress',\n      },\n    },\n  });\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Strapi sends emails via sendgrid. That's why you need to create a ",(0,r.kt)("a",{parentName:"p",href:"https://sendgrid.com/"},"SendGrid")," account and get an api-key.")),(0,r.kt)("p",null,"Now, let's send the text and subject in the collection of messages we created over the strapi as parameters to the send() function of the email plugin."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="api/messages/controllers/messages.js"',title:'"api/messages/controllers/messages.js"'},'const { parseMultipartData, sanitizeEntity } = require("strapi-utils");\n\nmodule.exports = {\n  async create(ctx) {\n    let entity;\n    if (ctx.is("multipart")) {\n      const { data, files } = parseMultipartData(ctx);\n      entity = await strapi.services.messages.create(data, { files });\n    } else {\n      entity = await strapi.services.messages.create(ctx.request.body);\n    }\n\n    entity = sanitizeEntity(entity, { model: strapi.models.messages });\n\n    const { subject, text } = entity;\n\n    const worker = (await strapi.services.subscribers.find()).map(\n      (subscriber) => {\n        let to = subscriber.email;\n\n        return strapi.plugins["email"].services.email.send({\n          subject,\n          text,\n          to,\n        });\n      }\n    );\n\n    await Promise.all(worker);\n\n    return entity;\n  },\n};\n')),(0,r.kt)("p",null,"Our project is finished. Let's try it now."),(0,r.kt)("div",{class:"img-container"},(0,r.kt)("div",{class:"window"},(0,r.kt)("div",{class:"control red"}),(0,r.kt)("div",{class:"control orange"}),(0,r.kt)("div",{class:"control green"})),(0,r.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2021-10-25-mail-subscription-with-refine/overview.png",alt:"overview"})),(0,r.kt)("br",null),"Let's send the same e-mail to our subscribers shown in the picture at once.",(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("div",{class:"img-container"},(0,r.kt)("div",{class:"window"},(0,r.kt)("div",{class:"control red"}),(0,r.kt)("div",{class:"control orange"}),(0,r.kt)("div",{class:"control green"})),(0,r.kt)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2021-10-25-mail-subscription-with-refine/send.gif",alt:"send"})),(0,r.kt)("br",null),(0,r.kt)("p",null,"Sending mail was successful. As you can see, we were able to send the same email to all subscribers by sending a single email."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/refinedev/refine/tree/master/examples/blog-mail-subscription"},"Here is repo")))}m.isMDXComponent=!0}}]);